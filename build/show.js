!function(){function e(e,t,a){var r=new XMLHttpRequest,o="http://readfree.me/book/"+e;r.onreadystatechange=function(){if(4==r.readyState&&200==r.status){var e=document.createElement("div");e.innerHTML=r.responseText;var i=(e.getElementsByTagName("a"),n(t,o));a.appendChild(i)}},r.open("GET",o,!0),r.setRequestHeader("Content-type","text/html"),r.send()}function t(e,t){var n=new XMLHttpRequest,a="http://readfree.me/search/?q="+e;n.onreadystatechange=function(){4==n.readyState&&200==n.status&&t&&t(n.responseText)},n.open("GET",a,!0),n.setRequestHeader("Content-type","text/html"),n.send()}function n(e,t){var n=null,a=null;if(e===d.LINK_TYPE.SUBJECT?(n="rf-book-page-main-link",a="ReadFree!"):e===d.LINK_TYPE.HOME?(n="rf-douban-home-link",a="ReadFree!"):e===d.LINK_TYPE.IMAGE&&(n="rf-normal-link",a="R!"),null!==n){var r=document.createElement("a");return r.setAttribute("href",t),r.setAttribute("target","_blank"),r.setAttribute("class",n),r.innerHTML=a,r}return null}function a(){var e=document.createElement("style");e.appendChild(document.createTextNode("")),document.head.appendChild(e);var t="#37a",n="#614e3c",a={".rf-book-page-main-link":{position:"fixed",top:"160px",left:"-10px",padding:"10px 20px 10px 30px",display:"block",background:n,color:"white !important"},".rf-douban-home-link":{display:"inline-block",padding:"2px 4px","text-align":"center",background:t,color:"white !important"},".rf-normal-link":{padding:"2px","text-align":"center",position:"absolute","margin-left":"-64px",display:"inline-block",background:t,color:"white !important"}};for(var r in a){var o=r+"{";for(var i in a[r])o+=i+": "+a[r][i]+";";o+="} ",e.sheet.insertRule(o,0)}}function r(){var t=location.pathname.match(/\/(\w+)\/(\d+)\//),n=document.getElementsByTagName("a");for(var a in n)!function(a){var r=void 0===n[a].href?null:n[a].href.match(/\/subject\/(\d+)(\/$|\/\?)/);if("cover"===n[a].className)return void e(r[1],d.LINK_TYPE.IMAGE,n[a].parentNode);var o=n[a].childNodes;for(var i in o)if("IMG"===o[i].tagName)return void("climg"===o[i].className&&e(r[1],d.LINK_TYPE.IMAGE,n[a].parentNode));var r=void 0===n[a].href?null:n[a].href.match(/\/subject\/(\d+)(\/$|\/\?)/);r&&(!t||t&&t[2]&&t[2]!==r[1])&&e(r[1],d.LINK_TYPE.HOME,n[a].parentNode)}(a);if(t){var r=t[1],i=t[2];"subject"===r&&e(i,d.LINK_TYPE.SUBJECT,document.body)}if("book.douban.com"===window.location.hostname){var l=document.getElementsByClassName("nav-items");if(l&&l[0]){l[0].addEventListener("mouseover",function(){var e=document.getElementById("readfree-menu");e&&(e.style.display="inline-block")},!1),l[0].addEventListener("mouseout",function(){var e=document.getElementById("readfree-menu");e&&(e.style.display="none")},!1);var c=document.createElement("li");c.setAttribute("id","readfree-menu"),c.style.display="none";var m=document.createElement("a");m.setAttribute("href","http://www.douban.com/people/ovilia1024/"),m.innerHTML="ReadFree 插件作者",c.appendChild(m),l[0].appendChild(c)}}o()}function o(){var e=document.getElementsByClassName("book_x");if(e.length>0)for(var t=0;t<e.length;++t)e[t].addEventListener("click",function(){var e=document.getElementById("book_rec").getElementsByTagName("a");handler(e,o)})}function i(){var e=document.getElementById("detail_bullets_id"),a="<b>ISBN:</b> ";if(e)for(var r=e.getElementsByTagName("li"),o=0,i=r.length;i>o;++o){var l=r[o].innerHTML,c=l.indexOf(a);if(c>-1){var m=l.indexOf(",");if(m>-1)var u=l.substr(a.length,m);else var u=l.substr(a.length);t(u,function(e){var t=document.createElement("html");t.innerHTML=e;var a=t.getElementsByClassName("pjax");if(a){var r="http://readfree.me/"+a[0].getAttribute("href"),o=n(d.LINK_TYPE.SUBJECT,r);document.body.appendChild(o)}});break}}}var d={LINK_TYPE:{SUBJECT:0,HOME:1,DOULIST:2,UPDATE:3,IMAGE:4}};a();var l=window.location.hostname;"www.douban.com"===l||"book.douban.com"===l?r():"www.amazon.cn"===l&&i()}();
