var cached={};chrome.runtime.onConnect.addListener(function(e){"douban-id"==e.name?e.onMessage.addListener(function(s){if(cached[s.url])e.postMessage(cached[s.url]);else{var t=new XMLHttpRequest;t.onload=function(){console.log(t),200==t.status?(s.success=!0,e.postMessage(s),cached[s.url]=s):404==t.status&&(s.success=!1,e.postMessage(s),cached[s.url]=s)},t.open("GET",s.url,!0),t.setRequestHeader("Content-type","text/html"),t.send()}}):"readfree-search"==e.name&&e.onMessage.addListener(function(s){if(cached[s.url])e.postMessage(cached[s.url]);else{var t=new XMLHttpRequest;t.onload=function(){if(console.log(t),200==t.status){var n=document.createElement("html");n.innerHTML=t.responseText;var a=n.getElementsByClassName("pjax");if(console.log(a),a){var r="https://readfree.me/"+a[0].getAttribute("href");s.readfreeUrl=r,s.success=!0,e.postMessage(s),cached[s.url]=s}else s.success=!1,e.postMessage(s),cached[s.url]=s}},t.open("GET",s.url,!0),t.setRequestHeader("Content-type","text/html"),t.send()}})}),chrome.runtime.onMessage.addListener(function(e,s,t){if("readfreeSearchByID"==e.contentScriptQuery){var n="https://readfree.me/search/?q="+e.doubanID+"&fmt=json";return fetch(n).then(e=>e.json()).then(e=>t(e)).catch(e=>console.log(e)),!0}});